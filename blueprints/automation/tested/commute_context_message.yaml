blueprint:
  name: Kontextbezogene Pendel-Nachrichten (2 Personen)
  description: >
    Schickt kontextbezogene, zufÃ¤llige Push-Nachrichten an die jeweils andere Person,
    wenn jemand (a) die Arbeit verlÃ¤sst, (b) an der Arbeit ankommt oder (c) zuhause ankommt.
    âš ï¸ Setze Personen, Zonen und Notify-Services nach dem Import in der UI.
  domain: automation
  input:
    person_a:
      name: Person A
      description: Person-EntitÃ¤t von Person A
      selector:
        entity:
          domain: person

    person_b:
      name: Person B
      description: Person-EntitÃ¤t von Person B
      selector:
        entity:
          domain: person

    zone_home:
      name: Zone â€“ Zuhause
      default: zone.home
      selector:
        entity:
          domain: zone

    zone_work_a:
      name: Zone â€“ Arbeit Person A
      selector:
        entity:
          domain: zone

    zone_work_b:
      name: Zone â€“ Arbeit Person B
      selector:
        entity:
          domain: zone

    notify_a:
      name: Notify-Service fÃ¼r Person A
      description: z. B. notify.mobile_app_pixel
      selector:
        text:

    notify_b:
      name: Notify-Service fÃ¼r Person B
      description: z. B. notify.mobile_app_iphone
      selector:
        text:

    msgs_leave_work:
      name: Nachrichten â€“ Arbeit verlassen (eine pro Zeile)
      description: Wird benutzt, wenn jemand die Arbeitszone verlÃ¤sst.
      default: |
        Ich fahre jetzt von der Arbeit los. ğŸš—
        Feierabend â€“ endlich Richtung Zuhause! ğŸŒ‡
        Bin auf dem Heimweg, bald bei dir. ğŸ
        Los gehtâ€™s nach Hause, freu mich schon. ğŸ¡
        Abfahrt! Arbeit ist durch. ğŸ™Œ
        Ich komme heim â€“ halte das Sofa warm. ğŸ›‹ï¸
        Roll los â€“ bis gleich. ğŸ‘‹
        Kleiner CountÂ­down bis wir uns sehen. â³
        Auf in die Freiheit! âœŒï¸
        Ich bin unterwegs, Kuss aufs Herz. ğŸ’‹
        Bye bye BÃ¼ro, hallo Freizeit. ğŸ‰
        Der Stift ist gefallen â€“ auf nach Hause. ğŸ–Šï¸
        StraÃŸe, mach Platz, ich komme. ğŸ›£ï¸
        Unterwegs â€“ Gedanke schon bei dir. ğŸ’­
        TschÃ¼ss Alltag, hallo wir. ğŸ¤
        Ich bring die gute Laune mit. ğŸ˜„
        Noch ein paar Kilometer, dann Umarmung. ğŸ¤—
        Bald gemeinsames Abendessen. ğŸ
        Fahr vorsichtig â€“ ach ja, das sagst du sonst immer. ğŸ˜‰
        Ab nach Hause â€“ Playlist lÃ¤uft! ğŸ¶
        Feierabendmodus: ON âœ…
        Heute warâ€™s genug â€“ jetzt zu dir. ğŸ’›
        Arbeit over, Liebe on. â¤ï¸
        Heimweg aktiviert â€“ bis gleich. ğŸ“
        Bin gleich bei meinem Lieblingsmenschen. ğŸ¥°
        Ich flitze los wie ein Superheld. ğŸ¦¸
        Der Heimweg fÃ¼hlt sich heute besonders schÃ¶n an. ğŸŒˆ
        Abfahrt, mein Herz zieht mich heim. ğŸ’“
        Ich lass den Tag hinter mir und komm zu dir. ğŸ”š
        Bin auf dem Weg, Kopf schon bei dir. ğŸŒŸ

      selector:
        text:
          multiline: true

    msgs_arrive_work:
      name: Nachrichten â€“ Ankunft Arbeit (eine pro Zeile)
      description: Wird benutzt, wenn jemand in der Arbeitszone ankommt.
      default: |
        Bin gut bei der Arbeit angekommen. âœ…
        Angekommen im BÃ¼ro â€“ los gehtâ€™s. ğŸ’¼
        Bin am Arbeitsplatz, meld mich spÃ¤ter. ğŸ“‡
        Landung im Office geglÃ¼ckt. âœˆï¸â¡ï¸ğŸ¢
        Arbeit erreicht â€“ dir einen schÃ¶nen Tag! â˜€ï¸
        Kaffee in der Hand, Laptop an. â˜•ï¸
        Bin drin â€“ jetzt wird angepackt. ğŸ’ª
        Startklar fÃ¼r den Tag. ğŸš€
        Bin angekommen, Kuss aus der Ferne. ğŸ˜˜
        BÃ¼rotÃ¼r hinter mir zu â€“ du im Kopf. ğŸ–¤
        Bin am Schreibtisch â€“ denke trotzdem an dich. ğŸ’­
        Ich bin safe angekommen, alles gut. ğŸ¤
        Jobmodus an, Herzmodus bleibt. â¤ï¸
        Angekommen â€“ erster Gedanke: du. ğŸŒŸ
        Jetzt heiÃŸtâ€™s: anpacken! Aber du bleibst mein Highlight. âœ¨
        Arbeitsplatz erreicht â€“ wÃ¼nsche dir einen tollen Tag. ğŸŒ
        Angekommen, Kopf halb Arbeit, halb bei dir. ğŸ§ ğŸ’˜
        Bin da â€“ voller Energie (noch). âš¡
        Arbeit ist da, Liebe bleibt. ğŸ’–
        Bin safe angekommen, bis spÃ¤ter. ğŸ“²
        BÃ¼ro da â€“ Herz bei dir. ğŸ«¶
        Bin angekommen, Fokus jetzt: To-Do-Liste. ğŸ“‹
        Lass uns spÃ¤ter Ã¼ber den Tag reden. ğŸ—£ï¸
        ArbeitstÃ¼r offen, Herz weit fÃ¼r dich. ğŸ’“
        Bin angekommen, Tag kann starten. ğŸŒ…
        Arbeit ruft â€“ aber meine Gedanken flÃ¼stern deinen Namen. ğŸ’Œ
        Bin hier â€“ aber in Gedanken neben dir. ğŸ¤—
        Angekommen, kleiner Check-in. âœ…
        Alles gut â€“ bin auf Arbeit. ğŸ‘
        Arbeit startet â€“ Vorfreude auf Feierabend! ğŸ•”

      selector:
        text:
          multiline: true

    msgs_arrive_home:
      name: Nachrichten â€“ Ankunft Zuhause (eine pro Zeile)
      description: Wird benutzt, wenn jemand zuhause ankommt.
      default: |
        Bin zuhause angekommen. ğŸ¡
        Zuhause! Endlich. ğŸ˜˜
        Angekommen â€“ Sofa-Time wartet. ğŸ›‹ï¸
        Bin daheim, gleich gemÃ¼tlich machen. ğŸ§¦
        Zuhause angekommen â€“ fÃ¼hle mich gleich besser. âœ¨
        Bin wieder da â€“ alles safe. âœ…
        Zuhause! Denk an dich. ğŸ’›
        Jetzt heiÃŸtâ€™s FÃ¼ÃŸe hoch. ğŸ‘£
        Bin da â€“ Herz geht an dich. â¤ï¸
        Endlich wieder daheim. ğŸ¤
        TÃ¼r hinter mir zu â€“ Ruhe an. ğŸ”‘
        Heimat erreicht, Lieblingsort. ğŸŒŸ
        Angekommen, alles okay. ğŸ‘
        Daheim â€“ jetzt nur noch du im Kopf. ğŸ¥°
        Zuhause gelandet, kuschelbereit. ğŸ§¸
        Bin da â€“ Kuss aus dem Flur. ğŸ’‹
        Heimatbasis erreicht. ğŸšª
        Jetzt beginnt der WohlfÃ¼hlteil des Tages. ğŸŒ™
        Daheim â€“ kleiner GlÃ¼cksmoment. ğŸŒˆ
        Bin angekommen â€“ wann siehâ€™n wir uns? ğŸ•°ï¸
        Zuhause, sofort an dich gedacht. ğŸ’­
        Ich bin angekommen â€“ wo bist du? ğŸ“
        Daheim â€“ Zeit fÃ¼r Qualitytime. ğŸ«¶
        Alles erledigt, jetzt nur noch entspannen. ğŸ˜Œ
        Bin zuhause â€“ Mission accomplished. ğŸ¯
        Angekommen, direkt Gedanken an dich. ğŸ’Œ
        Bin da, bereit fÃ¼r Kuscheleinheiten. ğŸ¤—
        Zuhause â€“ mit dir wÃ¤râ€™s perfekt. ğŸ’•
        Ich bin wieder gelandet. âœˆï¸â¡ï¸ğŸ¡
        Zuhause angekommen, Tag geschafft. ğŸŒ

      selector:
        text:
          multiline: true

mode: queued
max: 10

# --- TRIGGERS ---
trigger:
  # Person A: Arbeit verlassen / Arbeit ankommen / Zuhause ankommen
  - platform: zone
    entity_id: !input person_a
    zone: !input zone_work_a
    event: leave
    id: a_leaves_work
  - platform: zone
    entity_id: !input person_a
    zone: !input zone_work_a
    event: enter
    id: a_arrives_work
  - platform: zone
    entity_id: !input person_a
    zone: !input zone_home
    event: enter
    id: a_arrives_home

  # Person B: Arbeit verlassen / Arbeit ankommen / Zuhause ankommen
  - platform: zone
    entity_id: !input person_b
    zone: !input zone_work_b
    event: leave
    id: b_leaves_work
  - platform: zone
    entity_id: !input person_b
    zone: !input zone_work_b
    event: enter
    id: b_arrives_work
  - platform: zone
    entity_id: !input person_b
    zone: !input zone_home
    event: enter
    id: b_arrives_home

# --- VARIABLES ---
variables:
  v_notify_a: !input notify_a
  v_notify_b: !input notify_b
  v_msgs_leave_work: !input msgs_leave_work
  v_msgs_arrive_work: !input msgs_arrive_work
  v_msgs_arrive_home: !input msgs_arrive_home

# --- ACTIONS ---
action:
  - variables:
      pick_from: >-
        {% set which = iif(
          trigger.id in ['a_leaves_work','b_leaves_work'], 'leave_work',
          iif(trigger.id in ['a_arrives_work','b_arrives_work'], 'arrive_work', 'arrive_home')
        ) %}
        {{ which }}
      random_msg: >-
        {% set src = {
          'leave_work': v_msgs_leave_work,
          'arrive_work': v_msgs_arrive_work,
          'arrive_home': v_msgs_arrive_home
        }[pick_from] %}
        {% set lines = src.split('\n') | map('trim') | reject('equalto','') | list %}
        {% set fallback = {
          'leave_work': 'Ich fahre jetzt von der Arbeit los. ğŸš—',
          'arrive_work': 'Bin in der Arbeit angekommen. âœ…',
          'arrive_home': 'Bin zuhause angekommen. ğŸ¡'
        }[pick_from] %}
        {{ (lines | random) if lines|length > 0 else fallback }}

  - choose:
      # Absender: Person A â†’ EmpfÃ¤nger: Person B
      - conditions:
          - condition: trigger
            id: [a_leaves_work, a_arrives_work, a_arrives_home]
        sequence:
          - service: "{{ v_notify_b }}"
            data:
              title: >-
                {% if trigger.id == 'a_leaves_work' %}ğŸ’Œ Info â€“ Abfahrt Arbeit
                {% elif trigger.id == 'a_arrives_work' %}ğŸ’Œ Info â€“ Ankunft Arbeit
                {% else %}ğŸ’Œ Info â€“ Ankunft Zuhause{% endif %}
              message: "{{ random_msg }}"

      # Absender: Person B â†’ EmpfÃ¤nger: Person A
      - conditions:
          - condition: trigger
            id: [b_leaves_work, b_arrives_work, b_arrives_home]
        sequence:
          - service: "{{ v_notify_a }}"
            data:
              title: >-
                {% if trigger.id == 'b_leaves_work' %}ğŸ’Œ Info â€“ Abfahrt Arbeit
                {% elif trigger.id == 'b_arrives_work' %}ğŸ’Œ Info â€“ Ankunft Arbeit
                {% else %}ğŸ’Œ Info â€“ Ankunft Zuhause{% endif %}
              message: "{{ random_msg }}"
